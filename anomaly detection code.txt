# 이상 탐지 수행
model.eval()

threshold = 0.5  # 이상치 판별 임계값

with torch.no_grad():
    anomaly_count = 0
    for data, _ in test_dataloader:
        data = data.to(device)
        x_hat, mean, log_var = model(data)
        is_anomalous = torch.mean(torch.abs(data - x_hat)).item() > threshold
        if is_anomalous:
            anomaly_count += 1
            cv2.imshow(data)
            
print("이상치 개수:", anomaly_count)